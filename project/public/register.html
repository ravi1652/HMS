<style>
    .registration-container {
        background-color: #dfdada;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        width: 100vw;
    }

    .form-wrapper { 
        background-color: #fffcfc;
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        height: 100%;
        margin: 5rem;
        padding: 5rem 10rem;
        position: relative;
    }

    .close-image{
        position: absolute;
        right: 2rem;
        top: 2rem;
        width: 3rem;
    }

    .header-main{
        font-size: 3rem;
        font-family: Arial, Helvetica, sans-serif;
        font-weight: 800;
        margin-bottom: 3rem;
    }
    .header-sub{
        font-size: 2rem;
        font-family: Arial, Helvetica, sans-serif;
        margin-bottom: 5rem;
    }

    .form-content{
        display: flex;
        gap: 1.5rem;
        flex-direction: column;
        width: 100%;
    }

    .form-line{
        display: flex;
        gap:2rem;
    }

    .line-label{
        font-size: 1.5rem;
        font-family: Arial, Helvetica, sans-serif;
        font-weight: 600;
        width: 30%;
    }

    .input-box {
        padding: 10px 16px;
        border: 1px solid gray;
        border-radius: 10px;
        font-size: 16px;
    }

    .medium-box{
        width: 15rem;
    }

    .long1-box {
        width: 20rem;
    }
    .long2-box {
        width: 25rem;
    }

    .warning-text {
        color: red;
        font-family: Arial, Helvetica, sans-serif;
        font-weight: 500;
        font-size: 20px;
        margin-top: 1rem;
    }
    .submitBtn{
        padding: 0.75rem 5rem;
        background: #2196f3;
        border: none;
        border-radius: 8px;
        font-size: 1.5rem;
        font-family: Arial, Helvetica, sans-serif;
        font-weight: 500;
        color: white;
        width: fit-content;
    }
</style>

<section class="registration-container">
    <div class="form-wrapper">
        <a href="health.html"> <img loading="lazy" src="https://cdn.builder.io/api/v1/image/assets/TEMP/e10c463746a793f3886bf14deeb3669a838494f7e8b56dbf34eae63f6b39e637?placeholderIfAbsent=true&apiKey=4f72bb9bb15a45e7a2090cd9fe10537a" class="close-image" alt="" /></a>
        <div class="header-main">New Patient Registration</div>
        <div class="header-sub">Please fill in the form below</div>
        <form class="form-content" id="patient-register-form">
            <div class="form-line">
                <div class="line-label">Name - </div>
                <input required type="text" id="firstName" name="firstName" class="input-box" placeholder="First Name" />
                <input required type="text" id="lastName" name="lastName" class="input-box" placeholder="Last Name" />
            </div>
            <div class="form-line">
                <div class="line-label">Email - </div>
                <input required type="email" id="email" class="input-box long1-box" name="email" placeholder="example@email.com" />
            </div>
            <div class="form-line">
                <div class="line-label">Gender - </div>
                <select id="gender" name="gender" class="input-box medium-box" aria-label="Select Gender">
                    <option value="">Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-line">
                <div class="line-label">Date of Birth - </div>
                <input required type="date" name="dob" id="dob" class="input-box">
            </div>
            <div class="form-line">
                <div class="line-label">Ph. Number - </div>
                <input required type="text" id="phone" class="input-box long1-box" placeholder="Enter Phone Number" />
            </div>
            <div class="form-line">
                <div class="line-label">Address Line 1 - </div>
                <input required type="text" id="address1" class="input-box long2-box" name="address1" placeholder="Flat no, Soc,Locality" />
            </div>
            <div class="form-line">
                <div class="line-label">Address Line 2 - </div>
                <input required type="text" id="address2" class="input-box long2-box" name="address2" placeholder="City, State, Country" />
            </div>
            <div class="form-line">
                <div class="line-label">Line 3 (optional) - </div>
                <input type="text" id="address3" class="input-box long2-box" name="address3" placeholder="Landmark (optional)" />
            </div>
            <div class="form-line">
                <div class="line-label">Password - </div>
                <input required type="password" name="password" id="password" class="input-box long1-box" placeholder="Enter Password">
            </div>
            <div class="warning-text"></div>
            <button class="submitBtn" type="submit">
                <a href="./Login Page/Patient/patient.html">Submit</a>
            </button>
        </form>
    </div>
</section>

<script>
    const registerPatient = (data) => {
        console.log(data);
        fetch("http://localhost:3000/patient/register", {
            method: "POST",
            body: JSON.stringify(data),
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((res) => {
                if (res.ok) {
                    return res.json();
                }
                return res.json().then((body) => {
                    throw new Error(body.message)
                })
            })
            .then((res)=>console.log(res))
            .catch((err) => {
                document.querySelector(".warning-text").innerHTML = err.message;
            });
    };

    const form = document.querySelector("#patient-register-form");
    form.addEventListener("submit", (event) => {
        event.preventDefault();
        const inputsAll = form.querySelectorAll("input");
        const selectAll = form.querySelectorAll("select");
        for (let i = 0; i < inputsAll.length; i++) {
            if(inputsAll[i].name='address3'){
                continue;
            }
            if (inputsAll[i].value === "" || inputsAll[i].value === null || inputsAll[i].value === undefined) {
                document.querySelector(".warning-text").innerHTML = "Please Fill all the fields";
                return;
            }
        }
        for (let i = 0; i < selectAll.length; i++) {
            if (selectAll[i].value === "" || selectAll[i].value === null || selectAll[i].value === undefined) {
                document.querySelector(".warning-text").innerHTML = "Please Fill all the fields";
                return;
            }
        }
        document.querySelector(".warning-text").innerHTML = "";
        const dataBody = {
            name: `${form["firstName"].value} ${form["lastName"].value}`,
            email: form["email"].value,
            password: form["password"].value,
            address: `${form["address1"].value}, ${form["address2"].value}${form["address3"].value!=='' ? ", "+form["address3"].value : ""}`,
            dob: form["dob"].value,
            phone: form["phone"].value,
            gender: form["gender"].value,
        };

        registerPatient(dataBody);
    });
</script>
